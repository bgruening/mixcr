"bd-rhapsody-cdr3-base-A96":
  inheritFrom: generic-ht-single-cell-amplicon-with-umi
  abstract: true
  pipeline:
    - align
    - refineTagsAndSort
    - assemble
    - exportClones
  mixins:
    - type: LeftAlignmentBoundaryNoPoint
      floating: false
    - type: RightAlignmentBoundaryNoPoint
      floating: false
      geneType: C
  align:
    inheritFrom: align-single-cell
    overrides:
      tagTransformationSteps:
        - type: mapTags
          name: "CLS1"
          matchTags:
            - CELL1
          newTags:
            - CELL1ID
          allowOneMismatch: true
          rules:
            - from: GTCGCTATA
              to: '1'
            - from: CTTGTACTA
              to: '2'
            - from: CTTCACATA
              to: '3'
            - from: ACACGCCGG
              to: '4'
            - from: CGGTCCAGG
              to: '5'
            - from: AATCGAATG
              to: '6'
            - from: CCTAGTATA
              to: '7'
            - from: ATTGGCTAA
              to: '8'
            - from: AAGACATGC
              to: '9'
            - from: AAGGCGATC
              to: '10'
            - from: GTGTCCTTA
              to: '11'
            - from: GGATTAGGA
              to: '12'
            - from: ATGGATCCA
              to: '13'
            - from: ACATAAGCG
              to: '14'
            - from: AACTGTATT
              to: '15'
            - from: ACCTTGCGG
              to: '16'
            - from: CAGGTGTAG
              to: '17'
            - from: AGGAGATTA
              to: '18'
            - from: GCGATTACA
              to: '19'
            - from: ACCGGATAG
              to: '20'
            - from: CCACTTGGA
              to: '21'
            - from: AGAGAAGTT
              to: '22'
            - from: TAAGTTCGA
              to: '23'
            - from: ACGGATATT
              to: '24'
            - from: TGGCTCAGA
              to: '25'
            - from: GAATCTGTA
              to: '26'
            - from: ACCAAGGAC
              to: '27'
            - from: AGTATCTGT
              to: '28'
            - from: CACACACTA
              to: '29'
            - from: ATTAAGTGC
              to: '30'
            - from: AAGTAACCC
              to: '31'
            - from: AAATCCTGT
              to: '32'
            - from: CACATTGCA
              to: '33'
            - from: GCACTGTCA
              to: '34'
            - from: ATACTTAGG
              to: '35'
            - from: GCAATCCGA
              to: '36'
            - from: ACGCAATCA
              to: '37'
            - from: GAGTATTAG
              to: '38'
            - from: GACGGATTA
              to: '39'
            - from: CAGCTGACA
              to: '40'
            - from: CAACATATT
              to: '41'
            - from: AACTTCTCC
              to: '42'
            - from: CTATGAAAT
              to: '43'
            - from: ATTATTACC
              to: '44'
            - from: TACCGAGCA
              to: '45'
            - from: TCTCTTCAA
              to: '46'
            - from: TAAGCGTTA
              to: '47'
            - from: GCCTTACAA
              to: '48'
            - from: AGCACACAG
              to: '49'
            - from: ACAGTTCCG
              to: '50'
            - from: AGTAAAGCC
              to: '51'
            - from: CAGTTTCAC
              to: '52'
            - from: CGTTACTAA
              to: '53'
            - from: TTGTTCCAA
              to: '54'
            - from: AGAAGCACT
              to: '55'
            - from: CAGCAAGAT
              to: '56'
            - from: CAAACCGCC
              to: '57'
            - from: CTAACTCGC
              to: '58'
            - from: AATATTGGG
              to: '59'
            - from: AGAACTTCC
              to: '60'
            - from: CAAAGGCAC
              to: '61'
            - from: AAGCTCAAC
              to: '62'
            - from: TCCAGTCGA
              to: '63'
            - from: AGCCATCAC
              to: '64'
            - from: AACGAGAAG
              to: '65'
            - from: CTACAGAAC
              to: '66'
            - from: AGAGCTATG
              to: '67'
            - from: GAGGATGGA
              to: '68'
            - from: TGTACCTTA
              to: '69'
            - from: ACACACAAA
              to: '70'
            - from: TCAGGAGGA
              to: '71'
            - from: GAGGTGCTA
              to: '72'
            - from: ACCCTGACC
              to: '73'
            - from: ACAAGGATC
              to: '74'
            - from: ATCCCGGAG
              to: '75'
            - from: TATGTGGCA
              to: '76'
            - from: GCTGCCAAT
              to: '77'
            - from: ATCAGAGCT
              to: '78'
            - from: TCGAAGTGA
              to: '79'
            - from: ATAGACGAG
              to: '80'
            - from: AGCCCAATC
              to: '81'
            - from: CAGAATCGT
              to: '82'
            - from: ATCTCCACA
              to: '83'
            - from: ACGAAAGGT
              to: '84'
            - from: TAGCTTGTA
              to: '85'
            - from: ACACGAGAT
              to: '86'
            - from: AACCGCCTC
              to: '87'
            - from: ATTTAGATG
              to: '88'
            - from: CAAGCAAGC
              to: '89'
            - from: CAAAGTGTG
              to: '90'
            - from: GGCAAGCAA
              to: '91'
            - from: GAGCCAATA
              to: '92'
            - from: ATGTAATGG
              to: '93'
            - from: CCTGAGCAA
              to: '94'
            - from: GAGTACATT
              to: '95'
            - from: TGCGATCTA
              to: '96'
          reportingLevel: VerboseReport
        - type: mapTags
          name: "CLS2"
          matchTags:
            - CELL2
          newTags:
            - CELL2ID
          allowOneMismatch: true
          rules:
            - from: TACAGGATA
              to: '1'
            - from: CACCAGGTA
              to: '2'
            - from: TGTGAAGAA
              to: '3'
            - from: GATTCATCA
              to: '4'
            - from: CACCCAAAG
              to: '5'
            - from: CACAAAGGC
              to: '6'
            - from: GTGTGTCGA
              to: '7'
            - from: CTAGGTCCT
              to: '8'
            - from: ACAGTGGTA
              to: '9'
            - from: TCGTTAGCA
              to: '10'
            - from: AGCGACACC
              to: '11'
            - from: AAGCTACTT
              to: '12'
            - from: TGTTCTCCA
              to: '13'
            - from: ACGCGAAGC
              to: '14'
            - from: CAGAAATCG
              to: '15'
            - from: ACCAAAATG
              to: '16'
            - from: AGTGTTGTC
              to: '17'
            - from: TAGGGATAC
              to: '18'
            - from: AGGGCTGGT
              to: '19'
            - from: TCATCCTAA
              to: '20'
            - from: AATCCTGAA
              to: '21'
            - from: ATCCTAGGA
              to: '22'
            - from: ACGACCACC
              to: '23'
            - from: TTCCATTGA
              to: '24'
            - from: TAGTCTTGA
              to: '25'
            - from: ACTGTTAGA
              to: '26'
            - from: ATTCATCGT
              to: '27'
            - from: ACTTCGAGC
              to: '28'
            - from: TTGCGTACA
              to: '29'
            - from: CAGTGCCCG
              to: '30'
            - from: GACACTTAA
              to: '31'
            - from: AGGAGGCGC
              to: '32'
            - from: GCCTGTTCA
              to: '33'
            - from: GTACATCTA
              to: '34'
            - from: AATCAGTTT
              to: '35'
            - from: ACGATGAAT
              to: '36'
            - from: TGACAGACA
              to: '37'
            - from: ATTAGGCAT
              to: '38'
            - from: GGAGTCTAA
              to: '39'
            - from: TAGAACACA
              to: '40'
            - from: AAATAAATA
              to: '41'
            - from: CCGACAAGA
              to: '42'
            - from: CACCTACCC
              to: '43'
            - from: AAGAGTAGA
              to: '44'
            - from: TCATTGAGA
              to: '45'
            - from: GACCTTAGA
              to: '46'
            - from: CAAGACCTA
              to: '47'
            - from: GGAATGATA
              to: '48'
            - from: AAACGTACC
              to: '49'
            - from: ACTATCCTC
              to: '50'
            - from: CCGTATCTA
              to: '51'
            - from: ACACATGTC
              to: '52'
            - from: TTGGTATGA
              to: '53'
            - from: GTGCAGTAA
              to: '54'
            - from: AGGATTCAA
              to: '55'
            - from: AGAATGGAG
              to: '56'
            - from: CTCTCTCAA
              to: '57'
            - from: GCTAACTCA
              to: '58'
            - from: ATCAACCGA
              to: '59'
            - from: ATGAGTTAC
              to: '60'
            - from: ACTTGATGA
              to: '61'
            - from: ACTTTAACT
              to: '62'
            - from: TTGGAGGTA
              to: '63'
            - from: GCCAATGTA
              to: '64'
            - from: ATCCAACCG
              to: '65'
            - from: GATGAACTG
              to: '66'
            - from: CCATGCACA
              to: '67'
            - from: TAGTGACTA
              to: '68'
            - from: AAACTGCGC
              to: '69'
            - from: ATTACCAAG
              to: '70'
            - from: CACTCGAGA
              to: '71'
            - from: AACTCATTG
              to: '72'
            - from: CTTGCTTCA
              to: '73'
            - from: ACCTGAGTC
              to: '74'
            - from: AGGTTCGCT
              to: '75'
            - from: AAGGACTAT
              to: '76'
            - from: CGTTCGGTA
              to: '77'
            - from: AGATAGTTC
              to: '78'
            - from: CAATTGATC
              to: '79'
            - from: GCATGGCTA
              to: '80'
            - from: ACCAGGTGT
              to: '81'
            - from: AGCTGCCGT
              to: '82'
            - from: TATAGCCCT
              to: '83'
            - from: AGAGGACCA
              to: '84'
            - from: ACAATATGG
              to: '85'
            - from: CAGCACTTC
              to: '86'
            - from: CACTTATGT
              to: '87'
            - from: AGTGAAAGG
              to: '88'
            - from: AACCCTCGG
              to: '89'
            - from: AGGCAGCTA
              to: '90'
            - from: AACCAAAGT
              to: '91'
            - from: GAGTGCGAA
              to: '92'
            - from: CGCTAAGCA
              to: '93'
            - from: AATTATAAC
              to: '94'
            - from: TACTAGTCA
              to: '95'
            - from: CAACAACGG
              to: '96'
          reportingLevel: VerboseReport
        - type: mapTags
          name: "CLS3"
          matchTags:
            - CELL3
          newTags:
            - CELL3ID
          allowOneMismatch: true
          rules:
            - from: AAGCCTTCT
              to: '1'
            - from: ATCATTCTG
              to: '2'
            - from: CACAAGTAT
              to: '3'
            - from: ACACCTTAG
              to: '4'
            - from: GAACGACAA
              to: '5'
            - from: AGTCTGTAC
              to: '6'
            - from: AAATTACAG
              to: '7'
            - from: GGCTACAGA
              to: '8'
            - from: AATGTATCG
              to: '9'
            - from: CAAGTAGAA
              to: '10'
            - from: GATCTCTTA
              to: '11'
            - from: AACAACGCG
              to: '12'
            - from: GGTGAGTTA
              to: '13'
            - from: CAGGGAGGG
              to: '14'
            - from: TCCGTCTTA
              to: '15'
            - from: TGCATAGTA
              to: '16'
            - from: ACTTACGAT
              to: '17'
            - from: TGTATGCGA
              to: '18'
            - from: GCTCCTTGA
              to: '19'
            - from: GGCACAACA
              to: '20'
            - from: CTCAAGACA
              to: '21'
            - from: ACGCTGTTG
              to: '22'
            - from: ATATTGTAA
              to: '23'
            - from: AAGTTTACG
              to: '24'
            - from: CAGCCTGGC
              to: '25'
            - from: CTATTAGCC
              to: '26'
            - from: CAAACGTGG
              to: '27'
            - from: AAAGTCATT
              to: '28'
            - from: GTCTTGGCA
              to: '29'
            - from: GATCAGCGA
              to: '30'
            - from: ACATTCGGC
              to: '31'
            - from: AGTAATTAG
              to: '32'
            - from: TGAAGCCAA
              to: '33'
            - from: TCTACGACA
              to: '34'
            - from: CATAACGTT
              to: '35'
            - from: ATGGGACTC
              to: '36'
            - from: GATAGAGGA
              to: '37'
            - from: CTACATGCG
              to: '38'
            - from: CAACGATCT
              to: '39'
            - from: GTTAGCCTA
              to: '40'
            - from: AGTTGCATC
              to: '41'
            - from: AAGGGAACT
              to: '42'
            - from: ACTACATAT
              to: '43'
            - from: CTAAGCTTC
              to: '44'
            - from: ACGAACCAG
              to: '45'
            - from: TACTTCGGA
              to: '46'
            - from: AACATCCAT
              to: '47'
            - from: AGCCTGGTT
              to: '48'
            - from: CAAGTTTCC
              to: '49'
            - from: CAGGCATTT
              to: '50'
            - from: ACGTGGGAG
              to: '51'
            - from: TCTCACGGA
              to: '52'
            - from: GCAACATTA
              to: '53'
            - from: ATGGTCCGT
              to: '54'
            - from: CTATCATGA
              to: '55'
            - from: CAATACAAG
              to: '56'
            - from: AAAGAGGCC
              to: '57'
            - from: GTAGAAGCA
              to: '58'
            - from: GCTATGGAA
              to: '59'
            - from: ACTCCAGGG
              to: '60'
            - from: ACAAGTGCA
              to: '61'
            - from: GATGGTCCA
              to: '62'
            - from: TCCTCAATA
              to: '63'
            - from: AATAAACAA
              to: '64'
            - from: CTGTACGGA
              to: '65'
            - from: CTAGATAGA
              to: '66'
            - from: AGCTATGTG
              to: '67'
            - from: AAATGGAGG
              to: '68'
            - from: AGCCGCAAG
              to: '69'
            - from: ACAGTAAAC
              to: '70'
            - from: AACGTGTGA
              to: '71'
            - from: ACTGAATTC
              to: '72'
            - from: AAGGGTCAG
              to: '73'
            - from: TGTCTATCA
              to: '74'
            - from: TCAGATTCA
              to: '75'
            - from: CACGATCCG
              to: '76'
            - from: AACAGAAAC
              to: '77'
            - from: CATGAATGA
              to: '78'
            - from: CGTACTACG
              to: '79'
            - from: TTCAGCTCA
              to: '80'
            - from: AAGGCCGCA
              to: '81'
            - from: GGTTGGACA
              to: '82'
            - from: CGTCTAGGT
              to: '83'
            - from: AATTCGGCG
              to: '84'
            - from: CAACCTCCA
              to: '85'
            - from: CAATAGGGT
              to: '86'
            - from: ACAGGCTCC
              to: '87'
            - from: ACAACTAGT
              to: '88'
            - from: AGTTGTTCT
              to: '89'
            - from: AATTACCGG
              to: '90'
            - from: ACAAACTTT
              to: '91'
            - from: TCTCGGTTA
              to: '92'
            - from: ACTAGACCG
              to: '93'
            - from: ACTCATACG
              to: '94'
            - from: ATCGAGTCT
              to: '95'
            - from: CATAGGTCA
              to: '96'
          reportingLevel: VerboseReport
        - type: generic
          name: ""
          destinationTag: CELLID
          transformation:
            type: plus
            sources:
              - type: multiply
                sources:
                  - type: plus
                    sources:
                      - type: tag
                        name: CELL1ID
                      - type: constantNumber
                        value: -1
                  - type: constantNumber
                    value: 9216
              - type: multiply
                sources:
                  - type: plus
                    sources:
                      - type: tag
                        name: CELL2ID
                      - type: constantNumber
                        value: -1
                  - type: constantNumber
                    value: 96
              - type: tag
                name: CELL3ID
# HUMAN

"bd-rhapsody-human-vdj-cdr3":
  inheritFrom: bd-rhapsody-cdr3-base-A96
  mixins:
    - type: SetSpecies
      species: hs
    - type: SetTagPattern
      tagPattern: |
        ^(CELL1:N{9})actgN{8}(CELL2:N{9})ggtaN{9}(CELL3:N{9})(UMI:N{8}) |
        ^(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8})|
        ^a(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8})|
        ^gt(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8})|
        ^tca(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8}) \
        ^atcaaaatcggtgaataggcagac(R2:*)|
        ^gatctctgcttctgatggctca(R2:*)|
        ^atatccttggggtagaattccttc(R2:*)|
        ^gggaaacatctgcatcaagttg(R2:*)|
        ^ctttcgctccaggtcacact(R2:*)|
        ^tgtctgcaccctgatatgatgg(R2:*)|
        ^gtcaaggggaagacggatg(R2:*)|
        ^aagtagtccttgaccaggca(R2:*)|
        ^acaggagacgagggggaaaa(R2:*)|
        ^tcagatggcgggaagatgaa(R2:*)|
        ^accagtgtggccttgttg(R2:*)

# MOUSE

"bd-rhapsody-mouse-vdj-cdr3":
  inheritFrom: bd-rhapsody-cdr3-base-A96
  mixins:
    - type: SetSpecies
      species: mmu
    - type: SetTagPattern
      tagPattern: |
        ^(CELL1:N{9})actgN{8}(CELL2:N{9})ggtaN{9}(CELL3:N{9})(UMI:N{8}) | \
        ^(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8})| \
        ^a(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8})| \
        ^gt(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8})| \
        ^tca(CELL1:N{9})gtga(CELL2:N{9})gaca(CELL3:N{9})(UMI:N{8}) \
        ^aggttctgggttctggatgt(R2:*)|
        ^caatctctgcttttgatggctc(R2:*)|
        ^gtagaaatctttcaccagacaagc(R2:*)|
        ^ttgggggaaatgtctgca(R2:*)|
        ^aatagtaggcttgggagaaaagtctg(R2:*)|
        ^tgtcagtgggtagatggtgg(R2:*)|
        ^ctgacttccaattactaaacagcc(R2:*)|
        ^tagagctgagggttcctgatag(R2:*)|
        ^cagtggatagacagatgggggt(R2:*)|
        ^atggggctgttgttttgg(R2:*)|
        ^gtggatagactgatgggggtgtt(R2:*)|
        ^agggaagtagcctttgacaag(R2:*)|
        ^gacatttgggaaggactgactc(R2:*)|
        ^agatgttaactgctcactggatg(R2:*)|
        ^gttagtctcgagctcttcaga(R2:*)|
        ^cagtgtggctttgttttcct(R2:*)

"bd-rhapsody-bcr-full-length-base":
  abstract: true
  pipeline:
    inheritFrom: pipeline-single-cell-shotgun
  align:
    inheritFrom: align-single-cell
    overrides:
      tagPattern: ^N{0:13}ggtgcgt(CELL1:N{9})aatg(CELL2:N{9})ccac(CELL3:N{9})(UMI:N{8})\^(R2:*)
  refineTagsAndSort:
    whitelists:
      CELL1: builtin:rhapsody-cell1
      CELL2: builtin:rhapsody-cell2
      CELL3: builtin:rhapsody-cell3
    runCorrection: true
    parameters:
      correctionPower: 0.001
      backgroundSubstitutionRate: 0.01
      backgroundIndelRate: 1.0e-05
      minQuality: 12
      maxSubstitutions: 2
      maxIndels: 2
      maxTotalErrors: 3
      postFilter:
        type: filter_and
        operands:
          - type: filter_groups
            groupingKeys:
              - allTags:Cell
              - allTags:Molecule
            predicates:
              - metrics:
                  - type: "group_metric_sum_weight"
                    reportHist:
                      log: true
                      binNumber: 0
                      minBinWidth: 0.2
                operator:
                  type: group_operator_lowest_threshold
                  operators:
                    - type: group_operator_advanced_thresholding
                      algo:
                        type: otsu
                      histTransformers:
                        # Artificially adds 15% of singletons to the histogram before auto-thresholding algorithm
                        - type: inflate
                          fraction: 0.15
                      logX: true
                      minimalSample: 20
                      fallbackThreshold: 1.0
                    - type: group_operator_cumtop
                      share: 0.85
                      round: Down
          - type: filter_groups
            groupingKeys:
              - allTags:Cell
            predicates:
              - metrics:
                  - type: group_metric_nunique
                    reportHist:
                      log: true
                      binNumber: 0
                      minBinWidth: 0.2
                    keys:
                      - allTags:Molecule
                operator:
                  type: group_operator_range
                  lower: 3.0
  assemblePartial:
    inheritFrom: assemblePartial-base
  assemble:
    inheritFrom: assemble-with-consensus-base
    overrides:
      clnaOutput: true
      cellLevel: true
      consensusAssemblerParameters:
        assembler:
          aAssemblerParameters:
            bandWidth: 4
            scoring:
              type: linear
              alphabet: nucleotide
              subsMatrix: simple(match = 5, mismatch = -4)
              gapPenalty: -14
            minAlignmentScore: 40
            maxNormalizedAlignmentPenalty: 0.15
            trimMinimalSumQuality: 0
            trimReferenceRegion: false
            maxQuality: 45
          maxIterations: 6
          minAltSeedQualityScore: 11
          minAltSeedNormalizedPenalty: 0.35
          altSeedPenaltyTolerance: 0.3
          minRecordSharePerConsensus: 0.01
          minRecordsPerConsensus: 0
          minRecursiveRecordShare: 0.1
          minQualityScore: 0
          maxConsensuses: 3
      cloneAssemblerParameters:
        cloneClusteringParameters:
          clusteringFilter:
            type: relativeConcentration
            specificMutationProbability: 0.01
        badQualityThreshold: 0
        postFilters:
          - type: filter_in_groups
            isolationKeys:
              - geneLabel:ReliableChain
              - allTags:Cell
            nestedFilter:
              type: filter_groups
              groupingKeys:
                - clone
              predicates:
                - metrics:
                    - type: group_metric_sum_weight
                      reportHist:
                        log: true
                        binNumber: 0
                        minBinWidth: 0.2
                  operator:
                    type: group_operator_cumtop
                    share: 0.99
  assembleContigs:
    inheritFrom: assembleContigs-base
  exportAlignments:
    inheritFrom: exportAlignments-base
  exportClones:
    inheritFrom: exportClones-single-cell-with-umi-base

"bd-rhapsody-mouse-bcr-full-length":
  inheritFrom: bd-rhapsody-bcr-full-length-base
  mixins:
    - type: SetSpecies
      species: mmu

"bd-rhapsody-human-bcr-full-length":
  inheritFrom: bd-rhapsody-bcr-full-length-base
  mixins:
    - type: SetSpecies
      species: hsa

"bd-rhapsody-tcr-full-length-base":
  abstract: true
  mixins:
    - type: SetSpecies
      species: hsa
  pipeline:
    inheritFrom: pipeline-single-cell-shotgun
  align:
    inheritFrom: align-single-cell
    overrides:
      tagPattern: ^acaggaaactcatggtgcgt(CELL1:N{9})aatg(CELL2:N{9})ccac(CELL3:N{9})(UMI:N{8})\^(R2:*)
  refineTagsAndSort:
    whitelists:
      CELL1: builtin:rhapsody-cell1
      CELL2: builtin:rhapsody-cell2
      CELL3: builtin:rhapsody-cell3
    runCorrection: true
    parameters:
      correctionPower: 0.001
      backgroundSubstitutionRate: 0.01
      backgroundIndelRate: 1.0e-05
      minQuality: 12
      maxSubstitutions: 2
      maxIndels: 2
      maxTotalErrors: 3
      postFilter:
        type: filter_and
        operands:
          - type: filter_groups
            groupingKeys:
              - allTags:Cell
              - allTags:Molecule
            predicates:
              - metrics:
                  - type: "group_metric_sum_weight"
                    reportHist:
                      log: true
                      binNumber: 0
                      minBinWidth: 0.2
                operator:
                  type: group_operator_lowest_threshold
                  operators:
                    - type: group_operator_advanced_thresholding
                      algo:
                        type: otsu
                      histTransformers:
                        # Artificially adds 15% of singletons to the histogram before auto-thresholding algorithm
                        - type: inflate
                          fraction: 0.15
                      logX: true
                      minimalSample: 20
                      fallbackThreshold: 1.0
                    - type: group_operator_cumtop
                      share: 0.85
                      round: Down
  assemblePartial:
    inheritFrom: assemblePartial-base
  assemble:
    inheritFrom: assemble-with-consensus-base
    overrides:
      clnaOutput: true
      cellLevel: true
      consensusAssemblerParameters:
        assembler:
          aAssemblerParameters:
            bandWidth: 4
            scoring:
              type: linear
              alphabet: nucleotide
              subsMatrix: simple(match = 5, mismatch = -4)
              gapPenalty: -14
            minAlignmentScore: 40
            maxNormalizedAlignmentPenalty: 0.15
            trimMinimalSumQuality: 0
            trimReferenceRegion: false
            maxQuality: 45
          maxIterations: 6
          minAltSeedQualityScore: 11
          minAltSeedNormalizedPenalty: 0.35
          altSeedPenaltyTolerance: 0.3
          minRecordSharePerConsensus: 0.01
          minRecordsPerConsensus: 0
          minRecursiveRecordShare: 0.1
          minQualityScore: 0
          maxConsensuses: 3
      cloneAssemblerParameters:
        cloneClusteringParameters:
          clusteringFilter:
            type: relativeConcentration
            specificMutationProbability: 0.01
        badQualityThreshold: 0
        postFilters:
          - type: filter_in_groups
            isolationKeys:
              - geneLabel:ReliableChain
              - allTags:Cell
            nestedFilter:
              type: filter_groups
              groupingKeys:
                - clone
              predicates:
                - metrics:
                    - type: group_metric_sum_weight
                      reportHist:
                        log: true
                        binNumber: 0
                        minBinWidth: 0.2
                  operator:
                    type: group_operator_cumtop
                    share: 0.99
  assembleContigs:
    inheritFrom: assembleContigs-base
  exportAlignments:
    inheritFrom: exportAlignments-base
  exportClones:
    inheritFrom: exportClones-single-cell-with-umi-base

"bd-rhapsody-mouse-tcr-full-length":
  inheritFrom: bd-rhapsody-tcr-full-length-base
  mixins:
    - type: SetSpecies
      species: mmu

"bd-rhapsody-human-tcr-full-length":
  inheritFrom: bd-rhapsody-tcr-full-length-base
  mixins:
    - type: SetSpecies
      species: hsa